@page "/"
@using Howest.MagicCards.DAL.Models;
@inject IHttpClientFactory httpClientFactory


<PageTitle>MTG Deck Builder</PageTitle>

<h1>MTG Deck Builder</h1>

<div id="body">
    <div id="allCards">
        <AllCards GetDeck="getDeck"/>
    </div>

    <div id="deckCards">
        <DeckCards deckCards="@deckCards" message="@message"/>
    </div>
</div>


@code {
    private IEnumerable<DeckCard> deckCards { get; set; }
    private JsonSerializerOptions JsonOptions { get; }
    private string message;

    public Home() {
        JsonOptions = new JsonSerializerOptions
        {
            PropertyNameCaseInsensitive = true,
        };
    }

    protected override async void OnInitialized()
    {
        await getDeck();
    }

    public async Task getDeck()
    {
        HttpClient httpClient = httpClientFactory.CreateClient("MinimalAPI");

        HttpResponseMessage response = await httpClient.GetAsync("");

        string apiResponse = await response.Content.ReadAsStringAsync();

        if (response.IsSuccessStatusCode)
        {
            deckCards = JsonSerializer.Deserialize<IEnumerable<DeckCard>>(apiResponse, JsonOptions);
        }
        else
        {
            message = $"Error: {response.ReasonPhrase}";
        }
    }
}